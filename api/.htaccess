# RiduciSpese API - Apache Configuration
# Enable URL rewriting and security headers

# Enable Rewrite Engine
<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteBase /api/

    # Redirect all requests to index.php
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^(.*)$ index.php [QSA,L]
</IfModule>

# CORS Headers (if not handled by PHP)
<IfModule mod_headers.c>
    # Allow from any origin
    Header set Access-Control-Allow-Origin "*"

    # Allow specific methods
    Header set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"

    # Allow specific headers
    Header set Access-Control-Allow-Headers "Content-Type, Authorization, X-Requested-With"

    # Cache preflight requests
    Header set Access-Control-Max-Age "86400"
</IfModule>

# Security Headers
<IfModule mod_headers.c>
    # Prevent clickjacking
    Header set X-Frame-Options "SAMEORIGIN"

    # Prevent MIME sniffing
    Header set X-Content-Type-Options "nosniff"

    # Enable XSS protection
    Header set X-XSS-Protection "1; mode=block"

    # Referrer Policy
    Header set Referrer-Policy "strict-origin-when-cross-origin"
</IfModule>

# Disable directory browsing
Options -Indexes

# Protect sensitive files
<FilesMatch "(^\.htaccess|^config\.php|\.log$)">
    Order allow,deny
    Deny from all
</FilesMatch>

# PHP Settings
<IfModule mod_php.c>
    # Disable display of errors in production
    php_flag display_errors Off
    php_flag log_errors On

    # Set timezone
    php_value date.timezone "Europe/Rome"

    # Upload limits
    php_value upload_max_filesize 10M
    php_value post_max_size 10M

    # Memory limit
    php_value memory_limit 128M
</IfModule>

# Note: .git protection is handled by server configuration or FilesMatch
# DirectoryMatch is not allowed in .htaccess
